<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGNUL Protest Pulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 300px;
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen">

    <main class="w-full max-w-4xl mx-auto p-4 md:p-8 text-center">
        <header class="mb-8 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight">RGNUL Protest Pulse</h1>
            <p class="mt-2 text-lg text-gray-400">Real-time sentiment from the student body.</p>
        </header>

        <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-700">
            <div id="error-message" class="hidden bg-red-900/50 text-red-300 p-4 rounded-lg mb-6 border border-red-700"></div>

            <div class="flex flex-col md:flex-row items-center justify-around gap-8">
                <!-- Chart -->
                <div class="chart-container flex-shrink-0">
                    <canvas id="sentiment-chart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                        <span id="total-count" class="text-5xl font-bold text-white">0</span>
                        <span class="text-gray-400 tracking-wider uppercase text-sm">Total Votes</span>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-1 gap-6 w-full md:w-auto">
                    <div class="bg-green-500/10 p-4 rounded-lg text-left border border-green-500/30">
                        <div class="flex items-center gap-3">
                            <span class="w-3 h-3 rounded-full bg-green-500"></span>
                            <span class="text-gray-400">Yes, Protesting</span>
                        </div>
                        <p id="yes-count" class="text-3xl font-semibold text-white mt-1">0</p>
                    </div>
                    <div class="bg-red-500/10 p-4 rounded-lg text-left border border-red-500/30">
                        <div class="flex items-center gap-3">
                            <span class="w-3 h-3 rounded-full bg-red-500"></span>
                            <span class="text-gray-400">No, Not Protesting</span>
                        </div>
                        <p id="no-count" class="text-3xl font-semibold text-white mt-1">0</p>
                    </div>
                    <div class="bg-orange-500/10 p-4 rounded-lg text-left border border-orange-500/30">
                         <div class="flex items-center gap-3">
                            <span class="w-3 h-3 rounded-full bg-orange-500"></span>
                            <span class="text-gray-400">Undecided</span>
                        </div>
                        <p id="maybe-count" class="text-3xl font-semibold text-white mt-1">0</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        // Chart.js for the donut chart
        import "https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js";

        (async () => {
            // --- ACTION REQUIRED: PASTE YOUR FIREBASE CONFIGURATION HERE ---
            // Find this in your Firebase project:
            // Project settings (gear icon) > General tab > Your apps > Web app > SDK setup and configuration > Config
            const firebaseConfig = {
                apiKey: "AIzaSyBIT6TTm3JZJfZPPyibcydtgozu8QfTIg4",
                authDomain: "rgnul-protest-pulse.firebaseapp.com",
                projectId: "rgnul-protest-pulse",
                // The other keys (storageBucket, etc.) are not needed for this app
            };

            const appId = 'rgnul-protest-pulse'; // This can be any name, it's used for the database path

            // --- DOM Elements ---
            const yesCountEl = document.getElementById('yes-count');
            const noCountEl = document.getElementById('no-count');
            const maybeCountEl = document.getElementById('maybe-count');
            const totalCountEl = document.getElementById('total-count');
            const chartCanvas = document.getElementById('sentiment-chart');
            const errorMessage = document.getElementById('error-message');

            // --- Chart.js Setup ---
            const chartCtx = chartCanvas.getContext('2d');
            const sentimentChart = new Chart(chartCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Yes', 'No', 'Undecided'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#22c55e', '#ef4444', '#f97316'],
                        borderColor: '#111827',
                        borderWidth: 4,
                        hoverOffset: 16
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { display: false }, tooltip: { enabled: true } },
                    animation: { animateRotate: true, animateScale: true, duration: 1000, }
                }
            });

            // --- Firebase Initialization ---
            try {
                if (firebaseConfig.apiKey === "PASTE_YOUR_API_KEY") {
                    throw new Error("Firebase config is not set. Please update index.html.");
                }
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth(app);
                await signInAnonymously(auth);

                const docPath = `artifacts/${appId}/public/data/protest-counts/summary`;
                const docRef = doc(db, docPath);

                // --- Real-time Data Listener ---
                onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        const yes = data.yes || 0;
                        const no = data.no || 0;
                        const maybe = data.maybe || 0;
                        updateUI(yes, no, maybe);
                    }
                }, (error) => {
                    console.error("Error getting document:", error);
                    errorMessage.textContent = "Error connecting to the database.";
                    errorMessage.classList.remove('hidden');
                });

            } catch (error) {
                console.error("Firebase initialization error:", error);
                errorMessage.textContent = error.message;
                errorMessage.classList.remove('hidden');
            }

            function updateUI(yes, no, maybe) {
                 const total = yes + no + maybe;
                 yesCountEl.textContent = yes;
                 noCountEl.textContent = no;
                 maybeCountEl.textContent = maybe;
                 totalCountEl.textContent = total;
                 sentimentChart.data.datasets[0].data = [yes, no, maybe];
                 sentimentChart.update();
            }
        })();
    </script>
</body>
</html>

